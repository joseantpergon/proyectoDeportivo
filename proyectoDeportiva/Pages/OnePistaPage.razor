@page "/pistas/{pistaId}"

@using proyectoDeportiva.Areas.Identity.Data
@using proyectoDeportiva.Data
@using MudBlazor
@using System.Globalization
@using proyectoDeportiva.Components

@inject ILogger<PistasPage> Logger
@inject ApplicationDbContext _ApplicationDbContext

<MudCard Style=" max-width:1000px;width:80%; margin:auto ;">
    <MudCardContent>
        <h2>
            Detalles de la Pista
        </h2>
        @if (pista != null)
        {
            <MudGrid Style="display: flex; flex-direction:column; width:100%">
                <MudItem xs="12" md="6">
                    <h4>Información de la Pista</h4>
                    <MudList>
                        <MudListItem>
                            <span class="font-weight-bold">Nombre:</span>
                            <span>@pista.Nombre</span>
                        </MudListItem>
                        <MudListItem>
                            <span class="font-weight-bold">Estado:</span>
                            <span>@pista.Estado.Nombre</span>
                        </MudListItem>
                        <MudListItem>
                            <span class="font-weight-bold">Tipo de Deporte:</span>
                            <span>@pista.TipoDeporte.Nombre</span>
                        </MudListItem>
                        <MudListItem>
                            <span class="font-weight-bold">Horario de Apertura:</span>
                            <span>@pista.HorarioApertura.ToString("hh\\:mm")</span>
                        </MudListItem>
                        <MudListItem>
                            <span class="font-weight-bold">Horario de Cierre:</span>
                            <span>@pista.HorarioCierre.ToString("hh\\:mm")</span>
                        </MudListItem>
                        <MudListItem>
                            <span class="font-weight-bold">Capacidad Máxima:</span>
                            <span>@pista.CapacidadMaxima</span>
                        </MudListItem>
                        
                    </MudList>
                </MudItem>
                <MudItem xs="12" md="6">
                    <h4>Reserva</h4>
                    <CalendarioHora pista="pista" />
                    
                </MudItem>
            </MudGrid>
        }
    </MudCardContent>
</MudCard>

@code {
    [Parameter]
    public string PistaId { get; set; }

    private Pista pista;

    private DateTime fechaReserva = DateTime.Now;
    private TimeSpan horaReserva = TimeSpan.Zero;

    protected override async void OnInitialized()
    {
        bool bucle = true;

        while (bucle)
        {
            try
            {
                CargarPistaDesdeLista();
                bucle = false;
            }
            catch (InvalidOperationException e)
            {
                await Task.Delay(100);
            }
        }
    }
        
    

    private void CargarPistaDesdeLista()
    {
        if (int.TryParse(PistaId, out var pistaId))
        {
            pista = _ApplicationDbContext.Pistas.FirstOrDefault(p => p.Id == pistaId);
        }
    }

    private void ActualizarFechaReserva(DateTime nuevaFecha)
    {
        fechaReserva = nuevaFecha;
    }

    private void ActualizarHoraReserva(TimeSpan nuevaHora)
    {
        horaReserva = nuevaHora;
    }

  
}
